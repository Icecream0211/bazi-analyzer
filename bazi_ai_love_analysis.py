from ai_models.glm4 import GLM4Model
from bazi_need import get_bazi_need
import json

glm4_model = GLM4Model("c071cdc6b53eb53e1cd1cd6ad0a5e4db.fEV7OrCxYmiqazjd")

## 感情
def bazi_love_ai_analysis(result):
    prompt_format = f"""
    基于以下八字信息进行分析：
    {json.dumps(result, ensure_ascii=False)}
    
    """

    prompt = """
    你是一位擅长情感分析的八字命理专家，请根据用户的八字，详细分析其感情运势，并按以下格式输出结果：

    1. 感情性格特征（300字以内）：
    基于八字中五行的平衡情况和日主的强弱特征，分析用户在感情中的性格表现（如：是否主动、是否重情重义、对待感情的态度等）。

    2. 感情发展趋势（300字以内）：
    结合大运和流年，预测未来三年内用户的感情发展走势。描述可能出现的情感转折点、婚姻运势、或者感情中的挑战和机遇。

    3. 择偶建议（300字以内）：
    根据用户八字中的喜用神和情感需求，提供理想伴侣的五行特征、性格类型和适合的交往方式。

    4. 最合适的结婚和恋爱对象日柱：
    请输出最适合用户的结婚和恋爱对象的日柱，以及匹配度（满分10分）。例如：
    日柱: 甲午, 匹配度: 9, 木火相生，有利于感情和谐发展,
    日柱: 丙午, 匹配度: 8, 火土相生，能够互相扶持,
    日柱: 庚申, 匹配度: 7, 金水相生，沟通顺畅，
    ```

    5. 重要时机提醒（200字以内）：
    指出未来三年中适合发展感情或结婚的具体年份和月份，并说明如何利用这些时机推动感情生活。

    6. 提升感情运势建议（200字以内）：
    提供3-5条具体的建议，包括如何调整心态，避免某些情感误区，以及如何提升自身魅力等。

    请确保分析结果具体、实用，并直接与用户的八字特征相关联。避免笼统或模糊的表述，给出清晰、可操作的指导。
    """

    system_prompt = """
    你是一位专业的八字分析师，专攻感情和婚姻分析。请基于给定的八字信息进行分析，直接给出洞察和建议。
    避免重复原始数据，专注于提供有价值的解读和建议。
    使用通俗易懂的语言，确保分析结果清晰、简洁且富有洞察力。
    严格按照要求的格式输出结果。
    """

    print(prompt)
    print()
    print(system_prompt)
    print('-'*100)
    interpreted_result = glm4_model.chat(prompt_format+prompt, system_prompt)
    return interpreted_result



## 感情
def bazi_love_ai_analysis_stream(result):
    prompt_format = f"""
    基于以下八字信息进行分析：
    {json.dumps(result, ensure_ascii=False)}
    
    """

    prompt = """
    你是一位擅长情感分析的八字命理专家，请根据用户的八字，详细分析其感情运势，并按以下格式输出结果：

    1. 感情性格特征（300字以内）：
    基于八字中五行的平衡情况和日主的强弱特征，分析用户在感情中的性格表现（如：是否主动、是否重情重义、对待感情的态度等）。

    2. 感情发展趋势（300字以内）：
    结合大运和流年，预测未来三年内（今年是2024年）用户的感情发展走势。描述可能出现的情感转折点、婚姻运势、或者感情中的挑战和机遇。

    3. 择偶建议（300字以内）：
    根据用户八字中的喜用神和情感需求，提供理想伴侣的五行特征、性格类型和适合的交往方式。

    4. 最合适的结婚和恋爱对象日柱：
    请输出3个最适合用户的结婚和恋爱对象的日柱，以及匹配度（满分10分）。例如：
    最和谐日柱: 甲午, 匹配度: 9, 木火相生，有利于感情和谐发展,
    最财富日柱: 丙午, 匹配度: 8, 火土相生，能够互相扶持,
    最亲密日柱: 庚申, 匹配度: 7, 金水相生，沟通顺畅。

    5. 重要时机提醒（200字以内）：
    指出未来三年中（今年是2024年）适合发展感情或结婚的具体年份和月份，并说明如何利用这些时机推动感情生活。

    6. 提升感情运势建议（200字以内）：
    提供3-5条具体的建议，包括如何调整心态，避免某些情感误区，以及如何提升自身魅力等。

    请确保分析结果具体、实用，并直接与用户的八字特征相关联。避免笼统或模糊的表述，给出清晰、可操作的指导。
    """

    system_prompt = """
    你是一位专业的八字分析师，专攻感情和婚姻分析。请基于给定的八字信息进行分析，直接给出洞察和建议。
    避免重复原始数据，专注于提供有价值的解读和建议。
    使用通俗易懂的语言，确保分析结果清晰、简洁且富有洞察力。
    严格按照要求的格式输出结果。
    """

    print(prompt)
    print()
    print(system_prompt)
    print('-'*100)
    for chunk in glm4_model.stream_chat(prompt_format+prompt, system_prompt):
        yield chunk
